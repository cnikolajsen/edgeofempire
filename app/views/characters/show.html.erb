<%- model_class = Character -%>
<% content_for :title do %>
  <%= @character.name %> - <%= @character.race.name %> <%= @character.career.name %>
<% end %>
<div class="page-header">
  <h1><%=t '.title', :default => @character.name %> <small><%= @character.race.name %> <%= @character.career.name %></small></h1>
</div>
<% unless @character_state['state_message'].nil? %>
  <div class="alert alert-<%= @character_state['state_alert_class'] %>">
    <span class="label label-<%= @character_state['state_label_class'] %>"><%= @character_state['state_short'] %></span> <%= @character_state['state_message'] %>
  </div>
<% end %>

<%= render :partial => 'character_edit_menu' %>
<% unless @character.bio.empty? %>
  <div class="row-fluid">
    <div class="well span12">
      <%= simple_format(@character.bio) %>
    </div>
  </div>
<% end %>

<div class="row-fluid">
  <div class="well span9">
  <table class="table table-striped">
    <tbody>
      <tr>
        <td><strong><%= model_class.human_attribute_name(:brawn) %> <%= @character.brawn %></strong></td>
        <td><strong><%= model_class.human_attribute_name(:cunning) %> <%= @character.cunning %></strong></td>
        <td><strong><%= model_class.human_attribute_name(:presence) %> <%= @character.presence %></strong></td>
      </tr>
      <tr>
        <td><strong><%= model_class.human_attribute_name(:agility) %> <%= @character.agility %></strong></td>
        <td><strong><%= model_class.human_attribute_name(:intellect) %> <%= @character.intellect %></strong></td>
        <td><strong><%= model_class.human_attribute_name(:willpower) %> <%= @character.willpower %></strong></td>
      </tr>
      <tr>
        <td colspan="3"><strong>Skills:</strong>
          <% @character.character_skills.each do |character_skill| %>
            <% unless character_skill.skill.nil? or character_skill.ranks < 1 %>
              <span style="display: inline; white-space:nowrap;"><%= character_skill.skill.name %> <%= character_skill.ranks unless character_skill.ranks < 1  %> <%= render :partial => "dice_pool", :locals => {:score => @character.send(character_skill.skill.characteristic.downcase), :ranks => character_skill.ranks} %><% if @character.character_skills.last != character_skill %>,<% end %></span>
            <% end %>
          <% end %>
        </td>
      </tr>
      <tr>
        <td colspan="3"><strong>Talents:</strong>
          <% @talents.each_with_index do |element, index| %>
            <% talent_name = Talent.find_by_id(element[0]).name %>
            <%
              count = ''
              delimiter = ''
              options = ''
              if element[1]['count'] > 1
                unless element[1]['options'].empty?
                  options = " (#{element[1]['options'].join(', ')})"
                else
                  options = " (#{element[1]['count']})"
                end
              else
                unless element[1]['options'].empty?
                  options = " (#{element[1]['options'].join(', ')})"
                end
              end

              if index != @talents.length - 1
                delimiter = ", "
              end
            %>
            <%= "#{talent_name}#{options}#{delimiter}" %>
          <% end %>
        </td>
      </tr>
      <tr>
        <td><strong>Soak:</strong> <%= @soak%></td>
        <td></td>
        <td><strong>Defense:</strong> <%= @defense %></td>
      </tr>
      <tr>
        <td colspan="3"><strong>Wound Threshold:</strong> <%= @wound_th %></td>
      </tr>
      <tr>
        <td colspan="3"><strong>Strain Threshold:</strong> <%= @strain_th %></td>
      </tr>
      <tr>
        <td colspan="3"><strong>Equipment:</strong> <%= @equipment.join(', ').html_safe %></td>
      </tr>
      <tr>
        <td colspan="3"><strong>Attacks:</strong> <ul><li><%= @attacks.join('</li><li>').html_safe %></li></ul></td>
      </tr>
  
    </tbody>
  </table>
  </div>
  <div class="well well-small span3">
    <h5>Experience Points</h5>
    Earned: <%= @character.experience %><br />
    Spent:
  </div>
  <div class="well well-small span3">
    <h5>Credits</h5>
    <%= @character.credits %>
  </div>
  <div class="well well-small span3">
    <h4>Obligation</h4>
    <% @character.obligations.each do |obl| %>
      <h5><%= obl.name %></h5><%= text_replace_tokens(obl.description) %>
    <% end %>
  </div>
</div>
<div class="row-fluid">
  <div class="form-actions span12">
    <%= link_to "<i class='icon-chevron-left'></i> Back".html_safe,
                characters_path, :class => 'btn'  %>
    <%= link_to "<i class='icon-pencil'></i> Edit".html_safe,
                edit_character_path(@character), :class => 'btn btn-primary' %>
    <%= link_to "<i class='icon-print'></i> PDF".html_safe,
                character_path(@character, :format => 'pdf'), :class => 'btn btn-info', :target => "_blank" %>
    <%= link_to "<i class='icon-trash'></i> Delete".html_safe,
                character_path(@character),
                :method => 'delete',
                :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                :class => 'btn btn-danger' %>
    <%= link_to "<i class='icon-wrench'></i> Creation".html_safe, creation_character_path(@character), :class => 'btn btn-warning' if @character.may_set_create? && !@character.creation? %>
    <%= link_to "<i class='icon-ok'></i> Activate".html_safe, activate_character_path(@character), :class => 'btn btn-success' if @character.may_activate? %>
    <%= link_to "<i class='icon-fire'></i> Retire".html_safe, retire_character_path(@character), :class => 'btn btn-inverse' if @character.may_retire? %>
    
  </div>
</div>